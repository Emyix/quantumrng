<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QUANTUM RNG</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --bg-dark: #0a0a12;
            --card-bg: #111122;
            --neon-pink: #ff00ff;
            --neon-blue: #00f7ff;
            --neon-green: #00ff9d;
        }

        body {
            font-family: 'Orbitron', monospace;
            background: radial-gradient(ellipse at center, #0a0a12 0%, #000000 100%);
            color: white;
            overflow-x: hidden;
            user-select: none;
            min-height: 100vh;
        }

        /* --- New Rarity Badges --- */
        .rarity-badge {
            display: inline-block;
            padding: 8px 24px;
            font-weight: 900;
            letter-spacing: 3px;
            text-transform: uppercase;
            position: relative;
            overflow: hidden;
            margin: 5px;
            border-radius: 4px;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%);
            background-size: 200% 100%;
            animation: shimmer 3s infinite linear;
        }

        .rarity-common {
            background: linear-gradient(45deg, #2a2a3a, #3a3a4a);
            color: #8b8b9c;
            box-shadow: 0 0 10px #8b8b9c22;
        }

        .rarity-uncommon {
            background: linear-gradient(45deg, #003322, #005533);
            color: #00ff88;
            box-shadow: 0 0 20px #00ff8844;
            animation: pulse-green 2s infinite;
        }

        .rarity-rare {
            background: linear-gradient(45deg, #002244, #004488);
            color: #0088ff;
            box-shadow: 0 0 25px #0088ff66;
            animation: pulse-blue 1.8s infinite;
        }

        .rarity-epic {
            background: linear-gradient(45deg, #330033, #550055);
            color: #aa00ff;
            box-shadow: 0 0 30px #aa00ff88;
            animation: pulse-purple 1.6s infinite;
        }

        .rarity-vulcan {
            background: linear-gradient(45deg, #441100, #882200);
            color: #ff3300;
            box-shadow: 0 0 35px #ff3300aa, 0 0 70px #ff5500;
            animation: lava-flow 2s infinite, shake 0.5s infinite;
        }

        .rarity-void {
            background: linear-gradient(45deg, #220044, #440088);
            color: #9900ff;
            box-shadow: 0 0 40px #9900ff, 0 0 80px #7700ff;
            animation: void-pulse 2.5s infinite;
        }

        .rarity-abyssal {
            background: linear-gradient(45deg, #003344, #006688);
            color: #00ccff;
            box-shadow: 0 0 45px #00ccff, 0 0 90px #0099ff;
            animation: abyss-wave 3s infinite;
        }

        .rarity-celestial {
            background: linear-gradient(45deg, #443300, #886600);
            color: #ffff00;
            box-shadow: 0 0 50px #ffff00, 0 0 100px #ffaa00;
            animation: celestial-rotate 5s infinite linear, glow-yellow 2s infinite alternate;
        }

        .rarity-quantum {
            background: linear-gradient(45deg, #440044, #880088);
            color: #ff00ff;
            box-shadow: 0 0 55px #ff00ff, 0 0 110px #ff00ff;
            animation: quantum-shift 1.5s infinite alternate, rainbow 3s infinite linear;
        }

        .rarity-nebula {
            background: linear-gradient(45deg, #003333, #006666);
            color: #00ffcc;
            box-shadow: 0 0 60px #00ffcc, 0 0 120px #00ff99;
            animation: nebula-expand 4s infinite alternate, float 3s infinite ease-in-out;
        }

        .rarity-eternal {
            background: linear-gradient(45deg, #333333, #666666, #333333);
            background-size: 200% 200%;
            color: #ffffff;
            box-shadow: 0 0 70px #ffffff, 0 0 140px #88ffff;
            animation: eternal-radiate 2s infinite, shine 4s infinite linear;
        }

        .rarity-infinity {
            background: linear-gradient(45deg, #000000, #330000, #000033, #000000);
            background-size: 400% 400%;
            color: #ffffff;
            text-shadow: 0 0 10px #ff0000, 0 0 20px #00ffff;
            box-shadow: 
                0 0 80px #ff0000,
                0 0 160px #00ffff,
                inset 0 0 40px rgba(255,255,255,0.1);
            animation: 
                infinity-cycle 10s infinite linear,
                glitch 2s infinite,
                pulse-black 1s infinite alternate;
        }

        /* --- Rarity Badge Animations --- */
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        @keyframes pulse-green {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.9; }
        }

        @keyframes pulse-blue {
            0%, 100% { transform: scale(1); filter: brightness(1); }
            50% { transform: scale(1.03); filter: brightness(1.2); }
        }

        @keyframes pulse-purple {
            0%, 100% { box-shadow: 0 0 30px #aa00ff88; }
            50% { box-shadow: 0 0 45px #aa00ff, 0 0 60px #aa00ff66; }
        }

        @keyframes lava-flow {
            0% { background-position: 0% 50%; filter: hue-rotate(0deg); }
            100% { background-position: 100% 50%; filter: hue-rotate(20deg); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-2px); }
            75% { transform: translateX(2px); }
        }

        @keyframes void-pulse {
            0%, 100% { transform: scale(1); opacity: 0.9; }
            50% { transform: scale(1.08); opacity: 1; }
        }

        @keyframes abyss-wave {
            0% { background-position: 0% 0%; }
            100% { background-position: 200% 0%; }
        }

        @keyframes celestial-rotate {
            0% { transform: rotateY(0deg); }
            100% { transform: rotateY(360deg); }
        }

        @keyframes glow-yellow {
            0% { filter: brightness(1); }
            100% { filter: brightness(1.5); }
        }

        @keyframes quantum-shift {
            0% { transform: skewX(0deg); }
            100% { transform: skewX(5deg); }
        }

        @keyframes rainbow {
            0% { filter: hue-rotate(0deg); }
            100% { filter: hue-rotate(360deg); }
        }

        @keyframes nebula-expand {
            0% { transform: scale(1); }
            100% { transform: scale(1.1); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        @keyframes eternal-radiate {
            0%, 100% { box-shadow: 0 0 70px #ffffff, 0 0 140px #88ffff; }
            50% { box-shadow: 0 0 100px #ffffff, 0 0 200px #88ffff; }
        }

        @keyframes shine {
            0% { background-position: 0% 0%; }
            100% { background-position: 200% 200%; }
        }

        @keyframes infinity-cycle {
            0% { background-position: 0% 50%; filter: hue-rotate(0deg); }
            50% { background-position: 100% 50%; filter: hue-rotate(180deg); }
            100% { background-position: 0% 50%; filter: hue-rotate(360deg); }
        }

        @keyframes glitch {
            0%, 100% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(-2px, -2px); }
            60% { transform: translate(2px, 2px); }
            80% { transform: translate(2px, -2px); }
        }

        @keyframes pulse-black {
            0% { box-shadow: 0 0 80px #ff0000, 0 0 160px #00ffff; }
            100% { box-shadow: 0 0 120px #ff0000, 0 0 240px #00ffff; }
        }

        /* --- Aura Text Styles --- */
        .aura-text {
            font-family: 'Orbitron', monospace;
            font-weight: 900;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .aura-common { color: #8b8b9c; text-shadow: 0 0 10px #8b8b9c; }
        .aura-uncommon { color: #00ff88; text-shadow: 0 0 15px #00ff88; }
        .aura-rare { color: #0088ff; text-shadow: 0 0 20px #0088ff; }
        .aura-epic { color: #aa00ff; text-shadow: 0 0 25px #aa00ff; }
        .aura-vulcan { color: #ff3300; text-shadow: 0 0 30px #ff3300; animation: burn 2s infinite alternate; }
        .aura-void { color: #9900ff; text-shadow: 0 0 35px #9900ff; animation: swell 3s infinite; }
        .aura-abyssal { color: #00ccff; text-shadow: 0 0 40px #00ccff; animation: flow 4s infinite linear; }
        .aura-celestial { color: #ffff00; text-shadow: 0 0 45px #ffff00; animation: spin 5s infinite linear; }
        .aura-quantum { color: #ff00ff; text-shadow: 0 0 50px #ff00ff; animation: fluctuate 1.5s infinite alternate; }
        .aura-nebula { color: #00ffcc; text-shadow: 0 0 55px #00ffcc; animation: drift 6s infinite ease-in-out; }
        .aura-eternal { 
            color: #ffffff; 
            text-shadow: 0 0 60px #ffffff, 0 0 120px #88ffff;
            animation: eternal-glow 4s infinite linear;
        }
        .aura-infinity { 
            color: #000000;
            text-shadow: 
                3px 3px 0 #ff0000, 
                -3px -3px 0 #00ffff,
                0 0 20px #ff0000,
                0 0 40px #00ffff;
            animation: distort 0.8s infinite alternate;
        }

        @keyframes burn { 
            0% { filter: brightness(1) hue-rotate(0deg); }
            100% { filter: brightness(1.5) hue-rotate(10deg); }
        }
        
        @keyframes swell {
            0%, 100% { transform: scale(1); opacity: 0.9; }
            50% { transform: scale(1.05); opacity: 1; }
        }
        
        @keyframes flow {
            0% { background-position: 0% 50%; }
            100% { background-position: 200% 50%; }
        }
        
        @keyframes spin {
            0% { transform: rotateY(0deg); }
            100% { transform: rotateY(360deg); }
        }
        
        @keyframes fluctuate {
            0% { letter-spacing: 0px; opacity: 0.8; }
            100% { letter-spacing: 5px; opacity: 1; }
        }
        
        @keyframes drift {
            0%, 100% { transform: translateY(0) skew(0deg, 0deg); }
            33% { transform: translateY(-10px) skew(1deg, -1deg); }
            66% { transform: translateY(5px) skew(-1deg, 1deg); }
        }
        
        @keyframes eternal-glow {
            0% { background-position: 0% 50%; }
            100% { background-position: 200% 50%; }
        }
        
        @keyframes distort {
            0% { text-shadow: 3px 3px 0 #ff0000, -3px -3px 0 #00ffff; }
            100% { text-shadow: -3px -3px 0 #ff0000, 3px 3px 0 #00ffff; }
        }

        /* --- Collection Animations --- */
        .collection-card {
            transition: all 0.3s ease;
            background: rgba(20, 20, 40, 0.7);
            border: 1px solid transparent;
            position: relative;
            overflow: hidden;
            animation: card-float 6s infinite ease-in-out;
            animation-delay: calc(var(--index) * 0.1s);
        }
        
        .collection-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.7s;
        }
        
        .collection-card:hover::before {
            left: 100%;
        }
        
        @keyframes card-float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-5px) rotate(0.5deg); }
        }
        
        .collection-card.common:hover { border-color: #8b8b9c; box-shadow: 0 0 15px #8b8b9c66; }
        .collection-card.uncommon:hover { border-color: #00ff88; box-shadow: 0 0 20px #00ff8866; animation: hover-float 2s infinite ease-in-out; }
        .collection-card.rare:hover { border-color: #0088ff; box-shadow: 0 0 25px #0088ff66; animation: hover-pulse 1.5s infinite; }
        .collection-card.epic:hover { border-color: #aa00ff; box-shadow: 0 0 30px #aa00ff66; animation: hover-glow 2s infinite alternate; }
        .collection-card.vulcan:hover { border-color: #ff3300; box-shadow: 0 0 35px #ff330066; animation: hover-burn 1s infinite alternate; }
        .collection-card.void:hover { border-color: #9900ff; box-shadow: 0 0 40px #9900ff66; animation: hover-void 3s infinite; }
        .collection-card.abyssal:hover { border-color: #00ccff; box-shadow: 0 0 45px #00ccff66; animation: hover-abyss 4s infinite linear; }
        .collection-card.celestial:hover { border-color: #ffff00; box-shadow: 0 0 50px #ffff0066; animation: hover-spin 5s infinite linear; }
        .collection-card.quantum:hover { border-color: #ff00ff; box-shadow: 0 0 55px #ff00ff66; animation: hover-quantum 1.5s infinite alternate; }
        .collection-card.nebula:hover { border-color: #00ffcc; box-shadow: 0 0 60px #00ffcc66; animation: hover-nebula 6s infinite ease-in-out; }
        .collection-card.eternal:hover { border-color: #ffffff; box-shadow: 0 0 70px #ffffff66; animation: hover-eternal 4s infinite linear; }
        .collection-card.infinity:hover { 
            border-color: #ff0000; 
            box-shadow: 0 0 80px #ff000066, 0 0 80px #00ffff66;
            animation: hover-infinity 0.8s infinite alternate;
        }
        
        @keyframes hover-float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        @keyframes hover-pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        @keyframes hover-glow { 0% { filter: brightness(1); } 100% { filter: brightness(1.3); } }
        @keyframes hover-burn { 0% { filter: hue-rotate(0deg) brightness(1); } 100% { filter: hue-rotate(20deg) brightness(1.5); } }
        @keyframes hover-void { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.03); } }
        @keyframes hover-abyss { 0% { background-position: 0% 0%; } 100% { background-position: 200% 0%; } }
        @keyframes hover-spin { 0% { transform: rotateY(0deg); } 100% { transform: rotateY(360deg); } }
        @keyframes hover-quantum { 0% { letter-spacing: normal; } 100% { letter-spacing: 2px; } }
        @keyframes hover-nebula { 0%, 100% { transform: skew(0deg, 0deg); } 33% { transform: skew(1deg, -1deg); } 66% { transform: skew(-1deg, 1deg); } }
        @keyframes hover-eternal { 0% { background-position: 0% 50%; } 100% { background-position: 200% 50%; } }
        @keyframes hover-infinity { 0% { box-shadow: 0 0 40px #ff000066, 0 0 40px #00ffff66; } 100% { box-shadow: 0 0 80px #ff000066, 0 0 80px #00ffff66; } }

        /* --- Best Aura Display --- */
        .best-aura-display {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 4px;
            font-weight: 900;
            animation: best-float 6s infinite ease-in-out;
        }
        
        .best-aura-display.common { background: rgba(139, 139, 156, 0.2); }
        .best-aura-display.uncommon { background: rgba(0, 255, 136, 0.2); animation: best-float 3s infinite ease-in-out; }
        .best-aura-display.rare { background: rgba(0, 136, 255, 0.2); animation: best-pulse 2s infinite; }
        .best-aura-display.epic { background: rgba(170, 0, 255, 0.2); animation: best-glow 2.5s infinite alternate; }
        .best-aura-display.vulcan { background: rgba(255, 51, 0, 0.2); animation: best-burn 1.5s infinite alternate; }
        .best-aura-display.void { background: rgba(153, 0, 255, 0.2); animation: best-void 4s infinite; }
        .best-aura-display.abyssal { background: linear-gradient(45deg, rgba(0, 204, 255, 0.2), rgba(0, 102, 255, 0.2)); animation: best-abyss 5s infinite linear; }
        .best-aura-display.celestial { background: rgba(255, 255, 0, 0.2); animation: best-spin 6s infinite linear; }
        .best-aura-display.quantum { background: rgba(255, 0, 255, 0.2); animation: best-quantum 2s infinite alternate; }
        .best-aura-display.nebula { background: rgba(0, 255, 204, 0.2); animation: best-nebula 7s infinite ease-in-out; }
        .best-aura-display.eternal { 
            background: linear-gradient(90deg, rgba(255,255,255,0.2), rgba(136,255,255,0.2), rgba(255,255,255,0.2));
            background-size: 200% 100%;
            animation: best-eternal 4s infinite linear;
        }
        .best-aura-display.infinity {
            background: linear-gradient(90deg, rgba(255,0,0,0.2), rgba(0,255,255,0.2));
            animation: best-infinity 1s infinite alternate, glitch 2s infinite;
        }

        /* --- Potion Timer (Bottom Right) --- */
        #potion-timer {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #00ff00;
            border-radius: 10px;
            padding: 10px 15px;
            z-index: 100;
            display: none;
            box-shadow: 0 0 20px #00ff00;
            animation: potion-pulse 2s infinite;
        }
        
        @keyframes potion-pulse {
            0%, 100% { box-shadow: 0 0 20px #00ff00; }
            50% { box-shadow: 0 0 40px #00ff00, 0 0 60px #00ff00; }
        }
        
        .potion-active {
            color: #00ff00;
            font-weight: bold;
        }
        
        .coin-display {
            background: linear-gradient(45deg, #ffd700, #ffec8b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 900;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        
        .equipped-badge {
            position: absolute;
            top: 5px;
            left: 5px;
            background: #00ff00;
            color: black;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: bold;
            animation: equipped-pulse 1.5s infinite;
        }
        
        @keyframes equipped-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* --- Shop Styles --- */
        .shop-item {
            background: linear-gradient(45deg, #1a1a2a, #2a2a3a);
            border: 2px solid #00f7ff;
            border-radius: 10px;
            padding: 15px;
            transition: all 0.3s;
        }
        
        .shop-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 30px #00f7ff;
        }
        
        .shop-item.disabled {
            opacity: 0.5;
            filter: grayscale(1);
            cursor: not-allowed;
        }
        
        .shop-item.disabled:hover {
            transform: none;
            box-shadow: none;
        }

        /* --- Promo Code Window --- */
        #promo-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }
        
        .promo-window {
            background: linear-gradient(45deg, #0a0a1a, #1a1a2a);
            border: 2px solid #00ff00;
            border-radius: 15px;
            padding: 30px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 0 40px #00ff00;
        }
        
        .promo-input {
            width: 100%;
            padding: 12px 15px;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #00f7ff;
            border-radius: 8px;
            color: white;
            font-family: 'Orbitron', monospace;
            font-size: 16px;
            margin: 20px 0;
            text-align: center;
            letter-spacing: 2px;
            text-transform: uppercase;
        }
        
        .promo-input:focus {
            outline: none;
            box-shadow: 0 0 15px #00f7ff;
        }

        /* --- Cutscene Overlay --- */
        #cutscene-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 9999;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        
        .cutscene-particle {
            position: absolute;
            border-radius: 50%;
            pointer-events: none;
            animation: particle-explode 2s forwards;
        }
        
        .cutscene-flash {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: white;
            opacity: 0;
            pointer-events: none;
        }
        
        .cutscene-text {
            position: absolute;
            font-size: 8rem;
            font-weight: 900;
            letter-spacing: 10px;
            text-transform: uppercase;
            text-align: center;
            z-index: 10;
            transition: all 2s cubic-bezier(0.215, 0.610, 0.355, 1);
        }

        /* --- Cutscene Animations --- */
        @keyframes particle-explode {
            0% { transform: translate(0, 0) scale(0); opacity: 1; }
            100% { transform: translate(var(--tx), var(--ty)) scale(3); opacity: 0; }
        }

        /* Vulcan (5s) */
        @keyframes cutscene-vulcan {
            0% { transform: scale(0.1) rotate(0deg); opacity: 0; filter: blur(20px); }
            20% { transform: scale(1.5) rotate(180deg); opacity: 1; filter: blur(10px); }
            40% { transform: scale(0.8) rotate(360deg); opacity: 1; filter: blur(5px); }
            60% { transform: scale(1.2) rotate(540deg); opacity: 1; filter: blur(0px); }
            80% { transform: scale(0.9) rotate(720deg); opacity: 1; filter: blur(0px); }
            100% { transform: scale(1) rotate(900deg); opacity: 1; filter: blur(0px); }
        }

        /* Void (5s) */
        @keyframes cutscene-void {
            0% { transform: scale(10) rotateX(90deg); opacity: 0; filter: blur(50px); }
            30% { transform: scale(0.5) rotateX(0deg); opacity: 1; filter: blur(20px); }
            50% { transform: scale(1.5) rotateX(180deg); opacity: 1; filter: blur(10px); }
            70% { transform: scale(0.8) rotateX(270deg); opacity: 1; filter: blur(5px); }
            90% { transform: scale(1.1) rotateX(360deg); opacity: 1; filter: blur(0px); }
            100% { transform: scale(1) rotateX(360deg); opacity: 1; filter: blur(0px); }
        }

        /* Abyssal (5s) */
        @keyframes cutscene-abyssal {
            0% { transform: translateY(100vh) rotateX(90deg); opacity: 0; }
            20% { transform: translateY(-20vh) rotateX(0deg); opacity: 1; }
            40% { transform: translateY(10vh) rotateX(180deg); opacity: 1; }
            60% { transform: translateY(-5vh) rotateX(270deg); opacity: 1; }
            80% { transform: translateY(2vh) rotateX(360deg); opacity: 1; }
            100% { transform: translateY(0) rotateX(360deg); opacity: 1; }
        }

        /* Celestial (5s) */
        @keyframes cutscene-celestial {
            0% { transform: scale(0) rotate(0deg); opacity: 0; }
            20% { transform: scale(1.5) rotate(180deg); opacity: 1; }
            40% { transform: scale(0.8) rotate(360deg); opacity: 1; }
            60% { transform: scale(1.2) rotate(540deg); opacity: 1; }
            80% { transform: scale(0.9) rotate(720deg); opacity: 1; }
            100% { transform: scale(1) rotate(720deg); opacity: 1; }
        }

        /* Quantum (10s) */
        @keyframes cutscene-quantum {
            0% { transform: translateX(-100vw) translateY(-100vh) scale(0.1); opacity: 0; }
            10% { transform: translateX(100vw) translateY(100vh) scale(0.5); opacity: 0.5; }
            20% { transform: translateX(-100vw) translateY(100vh) scale(1); opacity: 0.5; }
            30% { transform: translateX(100vw) translateY(-100vh) scale(1.5); opacity: 0.5; }
            40% { transform: translateX(-50vw) translateY(50vh) scale(1); opacity: 0.7; }
            50% { transform: translateX(50vw) translateY(-50vh) scale(1.2); opacity: 0.7; }
            60% { transform: translateX(-25vw) translateY(25vh) scale(0.8); opacity: 0.9; }
            70% { transform: translateX(25vw) translateY(-25vh) scale(1.1); opacity: 0.9; }
            80% { transform: translateX(-10vw) translateY(10vh) scale(0.9); opacity: 1; }
            90% { transform: translateX(10vw) translateY(-10vh) scale(1.05); opacity: 1; }
            100% { transform: translateX(0) translateY(0) scale(1); opacity: 1; }
        }

        /* Nebula (20s) */
        @keyframes cutscene-nebula {
            0% { transform: scale(0.1) rotate(0deg); filter: blur(100px); opacity: 0; }
            5% { transform: scale(3) rotate(90deg); filter: blur(50px); opacity: 0.3; }
            10% { transform: scale(1.5) rotate(180deg); filter: blur(25px); opacity: 0.6; }
            15% { transform: scale(2) rotate(270deg); filter: blur(12px); opacity: 0.8; }
            20% { transform: scale(1.2) rotate(360deg); filter: blur(6px); opacity: 1; }
            25% { transform: scale(1.8) rotate(450deg); filter: blur(3px); opacity: 1; }
            30% { transform: scale(1.4) rotate(540deg); filter: blur(1px); opacity: 1; }
            35% { transform: scale(1.6) rotate(630deg); filter: blur(0px); opacity: 1; }
            40% { transform: scale(1.3) rotate(720deg); filter: blur(0px); opacity: 1; }
            45% { transform: scale(1.5) rotate(810deg); filter: blur(0px); opacity: 1; }
            50% { transform: scale(1.35) rotate(900deg); filter: blur(0px); opacity: 1; }
            55% { transform: scale(1.45) rotate(990deg); filter: blur(0px); opacity: 1; }
            60% { transform: scale(1.38) rotate(1080deg); filter: blur(0px); opacity: 1; }
            65% { transform: scale(1.42) rotate(1170deg); filter: blur(0px); opacity: 1; }
            70% { transform: scale(1.39) rotate(1260deg); filter: blur(0px); opacity: 1; }
            75% { transform: scale(1.41) rotate(1350deg); filter: blur(0px); opacity: 1; }
            80% { transform: scale(1.395) rotate(1440deg); filter: blur(0px); opacity: 1; }
            85% { transform: scale(1.405) rotate(1530deg); filter: blur(0px); opacity: 1; }
            90% { transform: scale(1.398) rotate(1620deg); filter: blur(0px); opacity: 1; }
            95% { transform: scale(1.402) rotate(1710deg); filter: blur(0px); opacity: 1; }
            100% { transform: scale(1.4) rotate(1800deg); filter: blur(0px); opacity: 1; }
        }

        /* Eternal (30s) */
        @keyframes cutscene-eternal {
            0% { transform: scale(0.1) translateY(100vh); opacity: 0; filter: brightness(0); }
            3% { transform: scale(1.5) translateY(-50vh); opacity: 0.8; filter: brightness(3); }
            6% { transform: scale(0.8) translateY(30vh); opacity: 1; filter: brightness(2); }
            9% { transform: scale(1.2) translateY(-10vh); opacity: 1; filter: brightness(4); }
            12% { transform: scale(0.9) translateY(5vh); opacity: 1; filter: brightness(3); }
            15% { transform: scale(1.1) translateY(-2vh); opacity: 1; filter: brightness(5); }
            18% { transform: scale(0.95) translateY(1vh); opacity: 1; filter: brightness(4); }
            21% { transform: scale(1.05) translateY(-0.5vh); opacity: 1; filter: brightness(6); }
            24% { transform: scale(0.98) translateY(0.2vh); opacity: 1; filter: brightness(5); }
            27% { transform: scale(1.02) translateY(-0.1vh); opacity: 1; filter: brightness(7); }
            30% { transform: scale(0.99) translateY(0.05vh); opacity: 1; filter: brightness(6); }
            33% { transform: scale(1.01) translateY(-0.02vh); opacity: 1; filter: brightness(8); }
            36% { transform: scale(0.995) translateY(0.01vh); opacity: 1; filter: brightness(7); }
            39% { transform: scale(1.005) translateY(-0.005vh); opacity: 1; filter: brightness(9); }
            42% { transform: scale(0.998) translateY(0.002vh); opacity: 1; filter: brightness(8); }
            45% { transform: scale(1.002) translateY(-0.001vh); opacity: 1; filter: brightness(10); }
            48% { transform: scale(0.999) translateY(0.0005vh); opacity: 1; filter: brightness(9); }
            51% { transform: scale(1.001) translateY(-0.0002vh); opacity: 1; filter: brightness(11); }
            54% { transform: scale(1) translateY(0vh); opacity: 1; filter: brightness(10); }
            60% { transform: scale(1) rotateY(180deg); opacity: 1; filter: brightness(8); }
            70% { transform: scale(1) rotateY(360deg); opacity: 1; filter: brightness(6); }
            80% { transform: scale(1) rotateY(540deg); opacity: 1; filter: brightness(4); }
            90% { transform: scale(1) rotateY(720deg); opacity: 1; filter: brightness(2); }
            100% { transform: scale(1) rotateY(900deg); opacity: 1; filter: brightness(1); }
        }

        /* Infinity (45s) - The Masterpiece */
        @keyframes cutscene-infinity {
            /* Phase 1: Birth (0-10s) */
            0% { transform: scale(100) rotate(0deg); opacity: 0; filter: invert(0) blur(100px); }
            2% { transform: scale(0.1) rotate(1800deg); opacity: 1; filter: invert(1) blur(50px); }
            4% { transform: scale(10) rotate(0deg); opacity: 1; filter: invert(0) blur(25px); }
            6% { transform: scale(0.5) rotate(900deg); opacity: 1; filter: invert(1) blur(12px); }
            8% { transform: scale(5) rotate(0deg); opacity: 1; filter: invert(0) blur(6px); }
            10% { transform: scale(1) rotate(360deg); opacity: 1; filter: invert(0) blur(0px); }
            
            /* Phase 2: Expansion (10-20s) */
            15% { transform: scale(1.5) rotate(720deg) translateX(50px); opacity: 1; }
            20% { transform: scale(1) rotate(1440deg) translateX(-50px); opacity: 1; }
            25% { transform: scale(1.3) rotate(2160deg) translateY(50px); opacity: 1; }
            30% { transform: scale(1) rotate(2880deg) translateY(-50px); opacity: 1; }
            
            /* Phase 3: Quantum Fluctuation (20-30s) */
            35% { transform: scale(1.2) rotate(3600deg) skewX(20deg); opacity: 1; }
            40% { transform: scale(1) rotate(4320deg) skewX(-20deg); opacity: 1; }
            45% { transform: scale(1.1) rotate(5040deg) skewY(20deg); opacity: 1; }
            50% { transform: scale(1) rotate(5760deg) skewY(-20deg); opacity: 1; }
            
            /* Phase 4: Reality Distortion (30-40s) */
            55% { transform: scale(1) rotate(6480deg) matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,50,50,0,1.1); opacity: 1; }
            60% { transform: scale(1) rotate(7200deg) matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,-50,-50,0,0.9); opacity: 1; }
            65% { transform: scale(1) rotate(7920deg) matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,50,1); opacity: 1; }
            70% { transform: scale(1) rotate(8640deg) matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,-50,1); opacity: 1; }
            
            /* Phase 5: Convergence (40-45s) */
            80% { transform: scale(1.5) rotate(9360deg) perspective(1000px) rotateX(60deg); opacity: 1; }
            85% { transform: scale(1.2) rotate(10080deg) perspective(1000px) rotateY(60deg); opacity: 1; }
            90% { transform: scale(0.8) rotate(10800deg) perspective(1000px) rotateX(0) rotateY(0); opacity: 1; }
            95% { transform: scale(1.1) rotate(11520deg); opacity: 1; }
            100% { transform: scale(1) rotate(12240deg); opacity: 1; }
        }

        /* --- Transition Animation --- */
        @keyframes transition-to-game {
            0% { 
                transform: scale(1) translate(0, 0); 
                font-size: 8rem; 
                opacity: 1;
            }
            100% { 
                transform: scale(0.3) translate(0, 100px); 
                font-size: 5rem; 
                opacity: 0;
            }
        }

        /* --- Custom Scrollbar --- */
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: #111122; }
        ::-webkit-scrollbar-thumb { background: linear-gradient(to bottom, #00f7ff, #ff00ff); border-radius: 5px; }
        ::-webkit-scrollbar-thumb:hover { background: linear-gradient(to bottom, #00ff9d, #00f7ff); }

        /* --- Button Effects --- */
        .btn-neon {
            background: transparent;
            border: 2px solid var(--neon-blue);
            color: var(--neon-blue);
            text-shadow: 0 0 10px var(--neon-blue);
            box-shadow: 0 0 20px var(--neon-blue), inset 0 0 20px rgba(0, 247, 255, 0.1);
            transition: all 0.3s;
        }
        
        .btn-neon:hover {
            background: rgba(0, 247, 255, 0.1);
            box-shadow: 0 0 30px var(--neon-blue), 0 0 40px var(--neon-blue), inset 0 0 20px rgba(0, 247, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .btn-neon-red {
            border-color: #ff3300;
            color: #ff3300;
            text-shadow: 0 0 10px #ff3300;
            box-shadow: 0 0 20px #ff3300, inset 0 0 20px rgba(255, 51, 0, 0.1);
        }
        
        .btn-neon-red:hover {
            background: rgba(255, 51, 0, 0.1);
            box-shadow: 0 0 30px #ff3300, 0 0 40px #ff3300, inset 0 0 20px rgba(255, 51, 0, 0.2);
        }
        
        .btn-neon-green {
            border-color: #00ff00;
            color: #00ff00;
            text-shadow: 0 0 10px #00ff00;
            box-shadow: 0 0 20px #00ff00, inset 0 0 20px rgba(0, 255, 0, 0.1);
        }
        
        .btn-neon-green:hover {
            background: rgba(0, 255, 0, 0.1);
            box-shadow: 0 0 30px #00ff00, 0 0 40px #00ff00, inset 0 0 20px rgba(0, 255, 0, 0.2);
        }

        /* --- Shine Effect --- */
        @keyframes shine {
            to { transform: translateX(100%); }
        }
        
        .shine-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transform: translateX(-100%);
        }
        
        .btn-shine:hover .shine-overlay {
            animation: shine 0.7s;
        }

        /* --- Background Effects --- */
        .bg-grid {
            background-image: 
                linear-gradient(rgba(0, 247, 255, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 247, 255, 0.05) 1px, transparent 1px);
            background-size: 50px 50px;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
            pointer-events: none;
        }
        
        .luck-multiplier {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #00ff00;
            border-radius: 10px;
            padding: 5px 10px;
            font-size: 14px;
            font-weight: bold;
            color: #00ff00;
            z-index: 5;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center overflow-hidden">

    <!-- Background Effects -->
    <div class="bg-grid"></div>

    <!-- Potion Timer (Bottom Right) -->
    <div id="potion-timer">
        <div class="flex items-center gap-2">
            <i class="fas fa-flask poiton-active"></i>
            <span>Зелье удачи: </span>
            <span id="potion-time" class="potion-active">60с</span>
        </div>
    </div>

    <!-- Luck Multiplier Display -->
    <div id="luck-multiplier" class="luck-multiplier" style="display: none;">
        Удача: <span id="multiplier-value">x1.0</span>
    </div>

    <!-- Promo Code Window -->
    <div id="promo-overlay">
        <div class="promo-window">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-green-400">
                    <i class="fas fa-gift mr-3"></i>ПРОМОКОДЫ
                </h2>
                <button onclick="togglePromo()" class="text-2xl text-gray-400 hover:text-white transition-colors">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <p class="text-gray-300 mb-4 text-center">
                Введите промокод для получения награды
            </p>
            
            <input type="text" id="promo-input" class="promo-input" placeholder="ВВЕДИТЕ КОД" maxlength="20">
            
            <div class="flex gap-4">
                <button onclick="activatePromo()" class="flex-1 py-3 bg-gradient-to-r from-green-700 to-green-900 hover:from-green-600 hover:to-green-800 rounded-lg font-bold text-lg transition-all flex items-center justify-center gap-2">
                    <i class="fas fa-check"></i> Активировать
                </button>
            </div>
            
            <div class="mt-6 p-3 bg-gradient-to-r from-green-900/30 to-blue-900/30 rounded-lg">
                <div class="flex items-center gap-2">
                    <i class="fas fa-lightbulb text-yellow-300"></i>
                    <p class="text-xs text-gray-300">
                        Активные промокоды: "RELEASE" и "1.0.0" - по 1000 монет
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Cutscene Overlay -->
    <div id="cutscene-overlay">
        <div id="cutscene-text" class="cutscene-text"></div>
        <div id="cutscene-sub" class="text-xl text-gray-300 mt-6 opacity-0 transition-opacity duration-1000 z-50"></div>
        <div class="cutscene-flash" id="cutscene-flash"></div>
    </div>

    <!-- Header / Stats -->
    <header class="w-full p-4 flex justify-between items-center bg-gradient-to-r from-black/80 to-purple-900/20 border-b border-cyan-500/30 z-10">
        <div class="flex flex-col">
            <h1 class="text-3xl font-black bg-clip-text text-transparent bg-gradient-to-r from-cyan-400 to-purple-500 tracking-wider">
                <i class="fas fa-atom mr-2"></i>QUANTUM RNG
            </h1>
            <span class="text-xs text-cyan-400/70 tracking-widest">v1.0.0</span>
        </div>
        <div class="flex gap-6 text-sm md:text-base">
            <div class="text-right">
                <p class="text-cyan-300/80 text-xs tracking-wider">МОНЕТЫ</p>
                <p id="coins-display" class="font-mono text-2xl coin-display font-bold">0</p>
            </div>
            <div class="text-right">
                <p class="text-cyan-300/80 text-xs tracking-wider">ПРОКРУТОВ</p>
                <p id="total-rolls" class="font-mono text-2xl text-cyan-300 font-bold">0</p>
            </div>
            <div class="text-right">
                <p class="text-cyan-300/80 text-xs tracking-wider">ЛУЧШАЯ АУРА</p>
                <p id="best-aura-top" class="font-bold text-lg">
                    <span class="best-aura-display common">НЕТ</span>
                </p>
            </div>
        </div>
    </header>

    <!-- Main Game Area -->
    <main class="flex-1 w-full max-w-5xl flex flex-col items-center justify-center p-6 relative">
        
        <!-- Current Aura Display -->
        <div class="relative w-full h-72 md:h-96 flex items-center justify-center mb-10">
            <!-- Animated Ring -->
            <div class="absolute w-64 h-64 md:w-80 md:h-80 rounded-full border-4 border-cyan-500/30 animate-spin-slow"></div>
            
            <!-- Glow Effect -->
            <div id="main-glow" class="absolute w-48 h-48 md:w-64 md:h-64 rounded-full blur-3xl opacity-20 transition-all duration-1000"></div>
            
            <!-- Main Display -->
            <div class="text-center z-20 transform transition-all duration-500" id="aura-display-container">
                <div id="current-aura-name" class="text-5xl md:text-7xl font-black tracking-wider mb-4 transition-all duration-500">
                    QUANTUM RNG
                </div>
                <div id="current-aura-rarity" class="mb-2">
                    <span class="rarity-badge rarity-common">Common</span>
                </div>
                <div id="current-aura-chance" class="text-xl md:text-2xl font-mono text-cyan-300/90 mb-2">
                    ? ? ? ? ?
                </div>
                <div id="current-aura-desc" class="text-sm text-gray-400 mt-4 max-w-md mx-auto h-8 opacity-90 italic">
                    Нажми ROLL чтобы начать квантовую симуляцию
                </div>
            </div>
        </div>

        <!-- Controls -->
        <div class="flex flex-col items-center gap-6 w-full">
            <button id="roll-btn" class="group relative w-56 h-20 btn-neon text-3xl font-black tracking-widest uppercase rounded-lg hover:scale-105 active:scale-95 transition-all duration-300 overflow-hidden">
                <span class="relative z-10 flex items-center justify-center gap-3">
                    <i class="fas fa-dice animate-pulse"></i> ROLL
                </span>
                <div class="shine-overlay"></div>
            </button>

            <div class="flex gap-6">
                <button id="auto-roll-btn" class="px-8 py-3 btn-neon-red rounded-lg text-lg font-bold hover:scale-105 active:scale-95 transition-all duration-300 flex items-center gap-3">
                    <i class="fas fa-bolt"></i> 
                    <span>AUTO: <span id="auto-status" class="text-red-400">OFF</span></span>
                </button>
                <button onclick="toggleInventory()" class="px-8 py-3 btn-neon rounded-lg text-lg font-bold hover:scale-105 active:scale-95 transition-all duration-300 flex items-center gap-3">
                    <i class="fas fa-box-open"></i> КОЛЛЕКЦИЯ
                </button>
                <button onclick="toggleShop()" class="px-8 py-3 btn-neon-green rounded-lg text-lg font-bold hover:scale-105 active:scale-95 transition-all duration-300 flex items-center gap-3">
                    <i class="fas fa-store"></i> МАГАЗИН
                </button>
                <button onclick="togglePromo()" class="px-8 py-3 btn-neon rounded-lg text-lg font-bold hover:scale-105 active:scale-95 transition-all duration-300 flex items-center gap-3">
                    <i class="fas fa-gift"></i> ПРОМОКОД
                </button>
            </div>
            
            <div class="text-xs text-cyan-400/70 mt-4 text-center max-w-md">
                <i class="fas fa-info-circle mr-2"></i>
                Удерживайте ROLL для быстрой прокрутки (без анимаций выбивания)
            </div>
        </div>

    </main>

    <!-- Inventory Drawer -->
    <div id="inventory-drawer" class="fixed bottom-0 left-0 w-full h-[70vh] bg-gradient-to-t from-black/95 to-purple-900/30 border-t border-cyan-500/30 backdrop-blur-lg transform translate-y-full transition-transform duration-500 z-40 shadow-2xl flex flex-col">
        <div class="p-6 border-b border-cyan-500/30 flex justify-between items-center bg-black/50">
            <h2 class="text-2xl font-black text-cyan-300">
                <i class="fas fa-gem mr-3 text-purple-400"></i>КОЛЛЕКЦИЯ АУР
            </h2>
            <div class="flex gap-6">
                 <button onclick="clearData()" class="text-sm text-red-400 hover:text-red-300 hover:underline transition-colors">
                    <i class="fas fa-trash mr-2"></i>Сброс
                 </button>
                 <button onclick="toggleInventory()" class="text-2xl text-cyan-300 hover:text-white transition-colors">
                    <i class="fas fa-times"></i>
                 </button>
            </div>
        </div>
        <div id="inventory-grid" class="p-6 grid grid-cols-3 md:grid-cols-5 lg:grid-cols-7 gap-4 overflow-y-auto flex-1">
            <!-- Inventory Items go here -->
        </div>
    </div>

    <!-- Shop Drawer -->
    <div id="shop-drawer" class="fixed bottom-0 left-0 w-full h-[70vh] bg-gradient-to-t from-black/95 to-green-900/30 border-t border-green-500/30 backdrop-blur-lg transform translate-y-full transition-transform duration-500 z-40 shadow-2xl flex flex-col">
        <div class="p-6 border-b border-green-500/30 flex justify-between items-center bg-black/50">
            <h2 class="text-2xl font-black text-green-300">
                <i class="fas fa-store mr-3 text-green-400"></i>МАГАЗИН
            </h2>
            <div class="flex items-center gap-4">
                <div class="text-lg font-bold coin-display">
                    <i class="fas fa-coins mr-2"></i><span id="shop-coins">0</span>
                </div>
                <button onclick="toggleShop()" class="text-2xl text-green-300 hover:text-white transition-colors">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div class="p-6 grid grid-cols-1 gap-6 overflow-y-auto flex-1">
            <!-- Luck Potion -->
            <div class="shop-item">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-bold text-green-400">Зелье удачи</h3>
                    <span class="text-lg font-bold coin-display">1000 <i class="fas fa-coins ml-1"></i></span>
                </div>
                <p class="text-gray-300 mb-4 text-sm">
                    Удваивает удачу игрока на 1 минуту. Учитывает бонус от экипированной ауры.
                </p>
                <div class="flex items-center justify-between">
                    <div class="text-xs text-gray-400">
                        <i class="fas fa-clock mr-1"></i>Длительность: 60 секунд
                    </div>
                    <button id="buy-potion-btn" onclick="buyLuckPotion()" class="px-4 py-2 bg-gradient-to-r from-green-700 to-green-900 hover:from-green-600 hover:to-green-800 rounded-lg font-bold transition-all">
                        Купить
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Game Data ---
        const AURAS = [
            { 
                id: 'common', 
                name: 'COMMON', 
                chance: 2, 
                color: 'aura-common', 
                rarityClass: 'rarity-common',
                hex: '#8b8b9c', 
                desc: 'Обычная энергетическая аура.', 
                cutscene: false,
                price: 0
            },
            { 
                id: 'uncommon', 
                name: 'UNCOMMON', 
                chance: 4, 
                color: 'aura-uncommon', 
                rarityClass: 'rarity-uncommon',
                hex: '#00ff88', 
                desc: 'Необычное энергетическое поле.', 
                cutscene: false,
                price: 3
            },
            { 
                id: 'rare', 
                name: 'RARE', 
                chance: 16, 
                color: 'aura-rare', 
                rarityClass: 'rarity-rare',
                hex: '#0088ff', 
                desc: 'Редкая синяя аура.', 
                cutscene: false,
                price: 20
            },
            { 
                id: 'epic', 
                name: 'EPIC', 
                chance: 64, 
                color: 'aura-epic', 
                rarityClass: 'rarity-epic',
                hex: '#aa00ff', 
                desc: 'Эпическая фиолетовая энергия.', 
                cutscene: false,
                price: 40
            },
            // New auras starting from pyromaniac
            { 
                id: 'vulcan', 
                name: 'VULCAN', 
                chance: 350, 
                color: 'aura-vulcan', 
                rarityClass: 'rarity-vulcan',
                hex: '#ff3300', 
                desc: 'Пламенная аура вулканической мощи.', 
                cutscene: true,
                cutsceneDuration: 5000,
                cutsceneAnimation: 'cutscene-vulcan',
                price: 100
            },
            { 
                id: 'void', 
                name: 'VOID', 
                chance: 600, 
                color: 'aura-void', 
                rarityClass: 'rarity-void',
                hex: '#9900ff', 
                desc: 'Аура космической пустоты.', 
                cutscene: true,
                cutsceneDuration: 5000,
                cutsceneAnimation: 'cutscene-void',
                price: 250
            },
            { 
                id: 'abyssal', 
                name: 'ABYSSAL', 
                chance: 1200, 
                color: 'aura-abyssal', 
                rarityClass: 'rarity-abyssal',
                hex: '#00ccff', 
                desc: 'Глубинная аура морской бездны.', 
                cutscene: true,
                cutsceneDuration: 5000,
                cutsceneAnimation: 'cutscene-abyssal',
                price: 700
            },
            { 
                id: 'celestial', 
                name: 'CELESTIAL', 
                chance: 5000, 
                color: 'aura-celestial', 
                rarityClass: 'rarity-celestial',
                hex: '#ffff00', 
                desc: 'Небесная аура звёздного света.', 
                cutscene: true,
                cutsceneDuration: 5000,
                cutsceneAnimation: 'cutscene-celestial',
                price: 2500,
                luckMultiplier: 1.1,
                canEquip: true
            },
            { 
                id: 'quantum', 
                name: 'QUANTUM', 
                chance: 15000, 
                color: 'aura-quantum', 
                rarityClass: 'rarity-quantum',
                hex: '#ff00ff', 
                desc: 'Квантовая аура неопределённости.', 
                cutscene: true,
                cutsceneDuration: 10000,
                cutsceneAnimation: 'cutscene-quantum',
                price: 10000,
                luckMultiplier: 1.3,
                canEquip: true
            },
            { 
                id: 'nebula', 
                name: 'NEBULA', 
                chance: 50000, 
                color: 'aura-nebula', 
                rarityClass: 'rarity-nebula',
                hex: '#00ffcc', 
                desc: 'Туманная аура космических облаков.', 
                cutscene: true,
                cutsceneDuration: 20000,
                cutsceneAnimation: 'cutscene-nebula',
                price: 50000,
                luckMultiplier: 1.5,
                canEquip: true
            },
            { 
                id: 'eternal', 
                name: 'ETERNAL', 
                chance: 250000, 
                color: 'aura-eternal', 
                rarityClass: 'rarity-eternal',
                hex: '#ffffff', 
                desc: 'Вечная аура бесконечности.', 
                cutscene: true,
                cutsceneDuration: 30000,
                cutsceneAnimation: 'cutscene-eternal',
                price: 500000,
                luckMultiplier: 1.8,
                canEquip: true
            },
            { 
                id: 'infinity', 
                name: 'INFINITY', 
                chance: 1000000, 
                color: 'aura-infinity', 
                rarityClass: 'rarity-infinity',
                hex: '#000000', 
                desc: 'Абсолютная аура бесконечности.', 
                cutscene: true,
                cutsceneDuration: 45000,
                cutsceneAnimation: 'cutscene-infinity',
                price: 1000000,
                luckMultiplier: 2.5,
                canEquip: true
            }
        ];

        // --- State ---
        let state = {
            totalRolls: 0,
            inventory: {}, // Map: id -> count
            bestAura: null, // object
            autoRoll: false,
            coins: 0,
            equippedAura: null, // aura id
            luckPotionActive: false,
            luckPotionTimeLeft: 0, // seconds
            luckPotionTimer: null,
            cutsceneActive: false,
            usedPromoCodes: [] // Array of used promo codes
        };

        // --- DOM Elements ---
        const rollBtn = document.getElementById('roll-btn');
        const autoBtn = document.getElementById('auto-roll-btn');
        const autoStatus = document.getElementById('auto-status');
        const nameDisplay = document.getElementById('current-aura-name');
        const rarityDisplay = document.getElementById('current-aura-rarity');
        const chanceDisplay = document.getElementById('current-aura-chance');
        const descDisplay = document.getElementById('current-aura-desc');
        const glowDisplay = document.getElementById('main-glow');
        const totalRollsDisplay = document.getElementById('total-rolls');
        const bestAuraTopDisplay = document.getElementById('best-aura-top');
        const coinsDisplay = document.getElementById('coins-display');
        const shopCoinsDisplay = document.getElementById('shop-coins');
        const inventoryGrid = document.getElementById('inventory-grid');
        const potionTimer = document.getElementById('potion-timer');
        const potionTimeDisplay = document.getElementById('potion-time');
        const luckMultiplierDisplay = document.getElementById('luck-multiplier');
        const multiplierValueDisplay = document.getElementById('multiplier-value');
        const promoOverlay = document.getElementById('promo-overlay');
        const promoInput = document.getElementById('promo-input');
        const cutsceneOverlay = document.getElementById('cutscene-overlay');
        const cutsceneText = document.getElementById('cutscene-text');
        const cutsceneSub = document.getElementById('cutscene-sub');
        const cutsceneFlash = document.getElementById('cutscene-flash');

        let isRolling = false;
        let autoInterval = null;
        let holdRollInterval = null;
        let isHolding = false;

        // --- Initialization ---
        function init() {
            loadData();
            updateStatsUI();
            renderInventory();
            updateLuckMultiplierDisplay();
            
            // Roll button events
            rollBtn.addEventListener('click', () => {
                if (!isRolling) performRoll();
            });
            
            // Hold for rapid roll
            rollBtn.addEventListener('mousedown', startHoldRoll);
            rollBtn.addEventListener('mouseup', stopHoldRoll);
            rollBtn.addEventListener('mouseleave', stopHoldRoll);
            rollBtn.addEventListener('touchstart', startHoldRoll);
            rollBtn.addEventListener('touchend', stopHoldRoll);
            
            autoBtn.addEventListener('click', toggleAutoRoll);
            
            // Start potion timer if active
            if (state.luckPotionActive) {
                startPotionTimer();
            }
            
            // Add CSS for spin animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes spin-slow { 
                    0% { transform: rotate(0deg); } 
                    100% { transform: rotate(360deg); } 
                }
                .animate-spin-slow { animation: spin-slow 20s linear infinite; }
            `;
            document.head.appendChild(style);
        }

        // --- Promo Code System ---
        function togglePromo() {
            if (promoOverlay.style.display === 'flex') {
                promoOverlay.style.display = 'none';
            } else {
                promoOverlay.style.display = 'flex';
                promoInput.value = '';
                promoInput.focus();
            }
        }
        
        function activatePromo() {
            const code = promoInput.value.trim().toUpperCase();
            
            if (!code) {
                showNotification('Введите промокод!', 'red');
                return;
            }
            
            // Check if already used
            if (state.usedPromoCodes.includes(code)) {
                showNotification('Этот промокод уже был использован!', 'red');
                return;
            }
            
            // Check valid codes
            let reward = 0;
            let valid = false;
            
            if (code === 'RELEASE') {
                reward = 1000;
                valid = true;
            } else if (code === '1.0.0') {
                reward = 1000;
                valid = true;
            }
            
            if (valid) {
                state.coins += reward;
                state.usedPromoCodes.push(code);
                
                showNotification(`Промокод активирован! Получено ${reward} монет!`, 'green');
                
                saveData();
                updateStatsUI();
                togglePromo();
            } else {
                showNotification('Неверный промокод!', 'red');
            }
        }

        // --- Hold to Roll ---
        function startHoldRoll(e) {
            e.preventDefault();
            if (isHolding || isRolling) return;
            isHolding = true;
            holdRollInterval = setInterval(() => {
                if (!isRolling) performRoll(true); // true = skip cutscene
            }, 200);
        }
        
        function stopHoldRoll() {
            isHolding = false;
            if (holdRollInterval) {
                clearInterval(holdRollInterval);
                holdRollInterval = null;
            }
        }

        // --- Luck System ---
        function getLuckMultiplier() {
            let multiplier = 1.0;
            
            // Add equipped aura bonus
            if (state.equippedAura) {
                const aura = AURAS.find(a => a.id === state.equippedAura);
                if (aura && aura.luckMultiplier) {
                    multiplier *= aura.luckMultiplier;
                }
            }
            
            // Add potion bonus
            if (state.luckPotionActive) {
                multiplier *= 2;
            }
            
            return multiplier;
        }
        
        function updateLuckMultiplierDisplay() {
            const multiplier = getLuckMultiplier();
            if (multiplier > 1.0) {
                luckMultiplierDisplay.style.display = 'block';
                multiplierValueDisplay.textContent = `x${multiplier.toFixed(1)}`;
            } else {
                luckMultiplierDisplay.style.display = 'none';
            }
        }

        // --- Core RNG Logic with Luck ---
        function getRandomAura() {
            const sortedAuras = [...AURAS].sort((a, b) => b.chance - a.chance);
            const luckMultiplier = getLuckMultiplier();

            for (let aura of sortedAuras) {
                // Adjust chance based on luck multiplier
                // Higher luck = better chance to get rare items
                const adjustedChance = aura.chance / luckMultiplier;
                const roll = Math.floor(Math.random() * adjustedChance);
                if (roll === 0) {
                    return aura;
                }
            }
            return AURAS[0];
        }

        async function performRoll(skipCutscene = false) {
            if (isRolling) return;
            isRolling = true;
            rollBtn.disabled = true;

            // Rolling visual effect
            let ticks = 0;
            const maxTicks = 15;
            const visualInterval = setInterval(() => {
                const randomTemp = AURAS[Math.floor(Math.random() * AURAS.length)];
                nameDisplay.innerText = randomTemp.name;
                nameDisplay.className = `text-5xl md:text-7xl font-black tracking-wider mb-4 ${randomTemp.color} blur-sm`;
                
                // Update rarity badge during rolling
                rarityDisplay.innerHTML = `<span class="rarity-badge ${randomTemp.rarityClass}">${randomTemp.name}</span>`;
                chanceDisplay.innerText = `1 in ${randomTemp.chance.toLocaleString()}`;
                
                ticks++;
                if (ticks >= maxTicks) clearInterval(visualInterval);
            }, 40);

            // Calculate Result
            const result = getRandomAura();

            // Wait for visual effect
            await new Promise(r => setTimeout(r, 650));

            // Skip cutscene if holding or auto mode
            const shouldPlayCutscene = result.cutscene && !skipCutscene && !state.autoRoll;
            
            if (shouldPlayCutscene) {
                if (state.autoRoll) {
                    toggleAutoRoll();
                }
                state.cutsceneActive = true;
                await playCutscene(result);
                state.cutsceneActive = false;
            }

            // Update State
            state.totalRolls++;
            if (!state.inventory[result.id]) state.inventory[result.id] = 0;
            state.inventory[result.id]++;
            
            if (!state.bestAura || result.chance > state.bestAura.chance) {
                state.bestAura = result;
            }

            saveData();
            updateStatsUI();
            displayResult(result);
            renderInventory();

            isRolling = false;
            rollBtn.disabled = false;
        }

        function displayResult(aura) {
            // Update Text
            nameDisplay.innerText = aura.name;
            nameDisplay.className = `text-5xl md:text-7xl font-black tracking-wider mb-4 ${aura.color} transition-all duration-500`;
            
            // Pop effect
            nameDisplay.style.transform = 'scale(1.1)';
            setTimeout(() => nameDisplay.style.transform = 'scale(1)', 200);

            // Update rarity badge
            rarityDisplay.innerHTML = `<span class="rarity-badge ${aura.rarityClass}">${aura.name}</span>`;
            chanceDisplay.innerText = `1 in ${aura.chance.toLocaleString()}`;
            descDisplay.innerText = aura.desc;

            // Update Glow
            glowDisplay.style.backgroundColor = aura.hex;
            glowDisplay.style.opacity = aura.chance > 100 ? '0.4' : '0.15';
            
            // Special effects for ultra rare auras
            if (aura.id === 'infinity') {
                document.body.style.animation = "shake 0.5s";
                setTimeout(() => document.body.style.animation = "", 500);
            }
        }

        // --- Potion System ---
        function buyLuckPotion() {
            if (state.coins >= 1000) {
                state.coins -= 1000;
                state.luckPotionActive = true;
                state.luckPotionTimeLeft = 60;
                
                potionTimer.style.display = 'block';
                startPotionTimer();
                
                // Show notification
                showNotification('Зелье удачи активировано! Удача удвоена на 1 минуту.', 'green');
                
                saveData();
                updateStatsUI();
                updateLuckMultiplierDisplay();
            } else {
                showNotification('Недостаточно монет для покупки зелья!', 'red');
            }
        }
        
        function startPotionTimer() {
            if (state.luckPotionTimer) {
                clearInterval(state.luckPotionTimer);
            }
            
            state.luckPotionTimer = setInterval(() => {
                // Pause timer during cutscenes
                if (!state.cutsceneActive) {
                    state.luckPotionTimeLeft--;
                    potionTimeDisplay.textContent = `${state.luckPotionTimeLeft}с`;
                    
                    if (state.luckPotionTimeLeft <= 0) {
                        clearInterval(state.luckPotionTimer);
                        state.luckPotionActive = false;
                        potionTimer.style.display = 'none';
                        
                        showNotification('Действие зелья удачи закончилось.', 'yellow');
                        
                        saveData();
                        updateLuckMultiplierDisplay();
                    }
                }
            }, 1000);
        }

        // --- Enhanced Cutscene System ---
        function playCutscene(aura) {
            return new Promise((resolve) => {
                cutsceneOverlay.style.display = 'flex';
                cutsceneText.style.opacity = '0';
                cutsceneText.style.transform = 'scale(0)';
                cutsceneText.innerHTML = aura.name;
                cutsceneText.className = `cutscene-text ${aura.color}`;
                
                // Reset flash
                cutsceneFlash.style.opacity = '0';
                
                // Show subtitle
                setTimeout(() => {
                    cutsceneSub.innerText = getCutsceneSubtitle(aura);
                    cutsceneSub.style.opacity = '1';
                }, 500);

                setTimeout(() => {
                    cutsceneSub.style.opacity = '0';
                }, 2000);

                // Start cutscene animation
                setTimeout(() => {
                    cutsceneText.style.opacity = '1';
                    cutsceneText.style.animation = `${aura.cutsceneAnimation} ${aura.cutsceneDuration/1000}s forwards`;
                    
                    // Create particles throughout the animation
                    const particleInterval = setInterval(() => {
                        createCutsceneParticles(aura, 5);
                    }, aura.cutsceneDuration / 20);
                    
                    // Flash effects based on aura rarity
                    const flashCount = Math.floor(aura.cutsceneDuration / 2000);
                    for(let i = 0; i < flashCount; i++) {
                        setTimeout(() => {
                            createFlash(aura);
                        }, (aura.cutsceneDuration / flashCount) * i);
                    }
                    
                    // End cutscene with transition to game
                    setTimeout(() => {
                        clearInterval(particleInterval);
                        
                        // Transition animation
                        cutsceneText.style.animation = `transition-to-game 2s forwards`;
                        
                        // Update game display
                        setTimeout(() => {
                            displayResult(aura);
                        }, 1000);
                        
                        // Hide cutscene
                        setTimeout(() => {
                            cutsceneOverlay.style.display = 'none';
                            cutsceneText.style.animation = '';
                            resolve();
                        }, 2000);
                        
                    }, aura.cutsceneDuration);
                    
                }, 2500);
            });
        }
        
        function getCutsceneSubtitle(aura) {
            const subtitles = {
                'vulcan': 'ЗЕМЛЯ ДРОЖИТ ОТ ИЗВЕРЖЕНИЯ...',
                'void': 'РЕАЛЬНОСТЬ ИСКАЖАЕТСЯ...',
                'abyssal': 'ГЛУБИНЫ ОКЕАНА ПРОБУЖДАЮТСЯ...',
                'celestial': 'НЕБЕСА ОТКРЫВАЮТ СВОИ ВРАТА...',
                'quantum': 'ВСЕЛЕННЫЕ КОЛЛАПСИРУЮТ...',
                'nebula': 'КОСМИЧЕСКИЕ ТУМАННОСТИ ФОРМИРУЮТСЯ...',
                'eternal': 'ВРЕМЯ ОСТАНАВЛИВАЕТСЯ...',
                'infinity': 'ВСЁ И НИЧТО СУЩЕСТВУЮТ ОДНОВРЕМЕННО...'
            };
            return subtitles[aura.id] || 'ВЫ ЧУВСТВУЕТЕ НЕВЕРОЯТНУЮ ЭНЕРГИЮ...';
        }
        
        function createCutsceneParticles(aura, count) {
            for(let i = 0; i < count; i++) {
                const particle = document.createElement('div');
                particle.className = 'cutscene-particle';
                particle.style.left = '50%';
                particle.style.top = '50%';
                particle.style.width = particle.style.height = (Math.random() * 6 + 2) + 'px';
                particle.style.backgroundColor = aura.hex;
                particle.style.boxShadow = `0 0 10px ${aura.hex}, 0 0 20px ${aura.hex}`;
                
                // Random direction
                const angle = Math.random() * Math.PI * 2;
                const distance = 100 + Math.random() * 200;
                particle.style.setProperty('--tx', `${Math.cos(angle) * distance}px`);
                particle.style.setProperty('--ty', `${Math.sin(angle) * distance}px`);
                
                cutsceneOverlay.appendChild(particle);
                setTimeout(() => particle.remove(), 2000);
            }
        }
        
        function createFlash(aura) {
            const flash = document.createElement('div');
            flash.className = 'cutscene-flash';
            flash.style.background = aura.hex;
            flash.style.opacity = '0.3';
            
            cutsceneOverlay.appendChild(flash);
            
            const anim = flash.animate([
                { opacity: 0.3 },
                { opacity: 0 }
            ], { duration: 500 });
            
            anim.onfinish = () => flash.remove();
        }

        // --- Inventory & UI ---
        function updateStatsUI() {
            totalRollsDisplay.innerText = state.totalRolls.toLocaleString();
            coinsDisplay.textContent = state.coins.toLocaleString();
            shopCoinsDisplay.textContent = state.coins.toLocaleString();
            
            if (state.bestAura) {
                bestAuraTopDisplay.innerHTML = `
                    <span class="best-aura-display ${state.bestAura.id} ${state.bestAura.color}">
                        ${state.bestAura.name}
                    </span>
                `;
            } else {
                bestAuraTopDisplay.innerHTML = `<span class="best-aura-display common">НЕТ</span>`;
            }
        }

        function toggleInventory() {
            const drawer = document.getElementById('inventory-drawer');
            const shop = document.getElementById('shop-drawer');
            shop.classList.add('translate-y-full');
            promoOverlay.style.display = 'none';
            
            if (drawer.classList.contains('translate-y-full')) {
                drawer.classList.remove('translate-y-full');
                renderInventory();
            } else {
                drawer.classList.add('translate-y-full');
            }
        }
        
        function toggleShop() {
            const drawer = document.getElementById('shop-drawer');
            const inventory = document.getElementById('inventory-drawer');
            inventory.classList.add('translate-y-full');
            promoOverlay.style.display = 'none';
            
            if (drawer.classList.contains('translate-y-full')) {
                drawer.classList.remove('translate-y-full');
            } else {
                drawer.classList.add('translate-y-full');
            }
        }

        function renderInventory() {
            inventoryGrid.innerHTML = '';
            const collectedIds = Object.keys(state.inventory);
            const collectedAuras = collectedIds
                .map(id => AURAS.find(a => a.id === id))
                .sort((a, b) => b.chance - a.chance);

            if (collectedAuras.length === 0) {
                inventoryGrid.innerHTML = `
                    <div class="col-span-full text-center text-gray-500 py-16">
                        <i class="fas fa-box-open text-5xl mb-4 opacity-50"></i>
                        <p class="text-xl">Коллекция пуста</p>
                        <p class="text-sm mt-2">Прокрутите рулетку чтобы получить первую ауру!</p>
                    </div>`;
                return;
            }

            collectedAuras.forEach((aura, index) => {
                const count = state.inventory[aura.id];
                const card = document.createElement('div');
                card.className = `collection-card ${aura.id} p-4 rounded-xl flex flex-col items-center relative group transition-all duration-300 hover:scale-105`;
                card.style.setProperty('--index', index);
                
                let equippedBadge = '';
                if (state.equippedAura === aura.id) {
                    equippedBadge = '<div class="equipped-badge">Экипировано</div>';
                }
                
                let buttons = '';
                if (aura.price > 0) {
                    buttons += `
                        <button onclick="sellAura('${aura.id}')" class="mt-2 text-xs bg-gradient-to-r from-yellow-700 to-yellow-900 hover:from-yellow-600 hover:to-yellow-800 px-3 py-2 rounded-lg text-white w-full transition-all">
                            Продать (${aura.price})
                        </button>
                    `;
                }
                
                if (aura.canEquip) {
                    if (state.equippedAura === aura.id) {
                        buttons += `
                            <button onclick="unequipAura()" class="mt-2 text-xs bg-gradient-to-r from-red-700 to-red-900 hover:from-red-600 hover:to-red-800 px-3 py-2 rounded-lg text-white w-full transition-all">
                                Снять
                            </button>
                        `;
                    } else {
                        buttons += `
                            <button onclick="equipAura('${aura.id}')" class="mt-2 text-xs bg-gradient-to-r from-green-700 to-green-900 hover:from-green-600 hover:to-green-800 px-3 py-2 rounded-lg text-white w-full transition-all">
                                Экипировать
                            </button>
                        `;
                    }
                } else {
                    buttons += `
                        <button onclick="showAura('${aura.id}')" class="mt-2 text-xs bg-gradient-to-r from-cyan-700 to-cyan-900 hover:from-cyan-600 hover:to-cyan-800 px-3 py-2 rounded-lg text-white w-full transition-all">
                            Показать
                        </button>
                    `;
                }
                
                card.innerHTML = `
                    ${equippedBadge}
                    <div class="absolute top-3 right-3 text-xs font-bold ${aura.color} bg-black/50 px-2 py-1 rounded-full">
                        x${count}
                    </div>
                    <div class="h-16 w-16 rounded-full mb-3 flex items-center justify-center bg-gradient-to-br from-black/50 to-gray-900/50 shadow-2xl">
                        <i class="fas fa-star ${aura.color} text-2xl"></i>
                    </div>
                    <div class="mb-2">
                        <span class="rarity-badge ${aura.rarityClass} text-xs">${aura.name}</span>
                    </div>
                    <div class="text-[10px] text-gray-400 mb-3 text-center">1 in ${aura.chance.toLocaleString()}</div>
                    ${buttons}
                `;
                inventoryGrid.appendChild(card);
            });
        }

        function showAura(id) {
            const aura = AURAS.find(a => a.id === id);
            displayResult(aura);
            toggleInventory();
        }
        
        function equipAura(id) {
            const aura = AURAS.find(a => a.id === id);
            if (aura && aura.canEquip) {
                state.equippedAura = id;
                showNotification(`Аура ${aura.name} экипирована! Удача: ×${aura.luckMultiplier.toFixed(1)}`, 'green');
                
                saveData();
                renderInventory();
                updateLuckMultiplierDisplay();
            }
        }
        
        function unequipAura() {
            state.equippedAura = null;
            showNotification('Аура снята', 'yellow');
            
            saveData();
            renderInventory();
            updateLuckMultiplierDisplay();
        }
        
        function sellAura(id) {
            const aura = AURAS.find(a => a.id === id);
            if (aura && state.inventory[id] > 0) {
                state.inventory[id]--;
                state.coins += aura.price;
                
                if (state.inventory[id] === 0) {
                    delete state.inventory[id];
                }
                
                // Unequip if selling equipped aura
                if (state.equippedAura === id) {
                    state.equippedAura = null;
                    updateLuckMultiplierDisplay();
                }
                
                showNotification(`Продана 1 аура ${aura.name} за ${aura.price} монет`, 'yellow');
                
                saveData();
                updateStatsUI();
                renderInventory();
            }
        }

        // --- Auto Roll ---
        function toggleAutoRoll() {
            state.autoRoll = !state.autoRoll;
            if (state.autoRoll) {
                autoStatus.innerText = "ON";
                autoStatus.className = "text-green-400 font-bold";
                autoBtn.classList.add('bg-red-900/20');
                
                autoInterval = setInterval(() => {
                    if (!isRolling) performRoll(true); // Skip cutscenes in auto mode
                }, 800);
            } else {
                autoStatus.innerText = "OFF";
                autoStatus.className = "text-red-400";
                autoBtn.classList.remove('bg-red-900/20');
                clearInterval(autoInterval);
            }
        }

        // --- Notification System ---
        function showNotification(message, color = 'cyan') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 left-1/2 transform -translate-x-1/2 bg-black/80 border border-${color}-500 text-${color}-300 px-6 py-3 rounded-lg z-50 shadow-lg transition-all duration-300`;
            notification.innerHTML = `
                <div class="flex items-center gap-3">
                    <i class="fas fa-info-circle"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translate(-50%, -20px)';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // --- Persistence ---
        function saveData() {
            const dataToSave = {
                rolls: state.totalRolls,
                inv: state.inventory,
                best: state.bestAura ? state.bestAura.id : null,
                coins: state.coins,
                equippedAura: state.equippedAura,
                luckPotionActive: state.luckPotionActive,
                luckPotionTimeLeft: state.luckPotionTimeLeft,
                usedPromoCodes: state.usedPromoCodes
            };
            localStorage.setItem('quantumRngSave', JSON.stringify(dataToSave));
        }

        function loadData() {
            const saved = localStorage.getItem('quantumRngSave');
            if (saved) {
                try {
                    const parsed = JSON.parse(saved);
                    state.totalRolls = parsed.rolls || 0;
                    state.inventory = parsed.inv || {};
                    state.coins = parsed.coins || 0;
                    state.equippedAura = parsed.equippedAura || null;
                    state.luckPotionActive = parsed.luckPotionActive || false;
                    state.luckPotionTimeLeft = parsed.luckPotionTimeLeft || 0;
                    state.usedPromoCodes = parsed.usedPromoCodes || [];
                    
                    if (parsed.best) {
                        state.bestAura = AURAS.find(a => a.id === parsed.best);
                    }
                } catch (e) {
                    console.error("Ошибка загрузки сохранения");
                }
            }
        }

        function clearData() {
            if(confirm("Вы уверены, что хотите полностью сбросить весь прогресс? Это действие нельзя отменить.")) {
                localStorage.removeItem('quantumRngSave');
                location.reload();
            }
        }

        // Start the game
        init();

    </script>
</body>
</html>